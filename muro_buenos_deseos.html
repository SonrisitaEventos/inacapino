<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Muro de los Buenos Deseos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body { font-family: Arial, sans-serif; background-color: #111; color: white; text-align: center; padding: 20px; }
    .muro { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
    .mensaje { width: 220px; min-height: 120px; padding: 15px; border-radius: 12px; font-weight: bold; color: black; position: relative; animation: flotar 0.5s ease; box-shadow: 2px 2px 5px #000; }
    .ranking-numero { position: absolute; bottom: 5px; left: 10px; background-color: rgba(255,255,255,0.7); color: black; font-weight: bold; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .corazon { position: absolute; bottom: 5px; right: 10px; cursor: pointer; font-size: 18px; color: gray; }
    .corazon.activo { color: red; animation: latido 0.4s; }
    @keyframes flotar { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes latido { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
  </style>
</head>
<body>
  <h1>Muro de los Buenos Deseos</h1>
  <div class="muro" id="muro"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzpaFAHh3aKnHWip5Q5Rd5YLrdVKk2rUwaQ8Yd_RxUr224bPkfa0d4fkqTnI3zG04Xn/exec";
    const sheetURL = "https://opensheet.elk.sh/1FKHc3KV4rIym0WX1K_zOSPRydVfUi3TT7KyxJz4fyXc";

    function votar(nombre, mensaje, fecha) {
      fetch(scriptURL, {
        method: "POST",
        body: new URLSearchParams({
          action: "votar",
          nombre,
          mensaje,
          fecha
        })
      }).then(() => cargarMensajes());
    }

    function cargarMensajes() {
      fetch(sheetURL)
        .then(r => r.json())
        .then(data => {
          const muro = document.getElementById("muro");
          muro.innerHTML = "";
          data
            .map((msg, i) => ({
              nombre: msg.Nombre || msg.nombre,
              mensaje: msg.Mensaje || msg.mensaje,
              fecha: msg.Fecha || msg.fecha,
              color: msg.Color || msg.color,
              votos: parseInt(msg.Votos || msg.votos) || 0,
            }))
            .sort((a, b) => b.votos - a.votos)
            .forEach((msg, i) => {
              const tarjeta = document.createElement("div");
              tarjeta.className = "mensaje";
              tarjeta.style.backgroundColor = msg.color;
              tarjeta.innerHTML = `
                <div class="ranking-numero">${i + 1}</div>
                <div class="corazon" onclick="votar(\"${msg.nombre}\", \"${msg.mensaje}\", \"${msg.fecha}\")">
                  <i class="fa-solid fa-heart"></i>
                  <div>${msg.votos}</div>
                </div>
                <strong>${msg.nombre}</strong><br>
                ${msg.mensaje}<br>
                <small>${msg.fecha}</small>
              `;
              muro.appendChild(tarjeta);
            });
        });
    }

    cargarMensajes();
  </script>
</body>
</html>
