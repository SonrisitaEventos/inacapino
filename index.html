<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>El Inacapino Puerto Montt</title>
  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    .video-overlay-container {
      position: relative;
      width: 100%;
      max-width: 1430px;
      margin: 30px auto;
    }
    .marco-overlay {
      width: 100%;
      display: block;
    }
    .video-in-marco {
      position: absolute;
      top: 11.5%;
      left: 6.3%;
      width: 87.4%;
      height: 76.2%;
      border: none;
      border-radius: 10px;
      display: none;
    }
    .vip-button {
      margin: 20px auto;
      background: #8000ff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
    }
    .admin-controls {
      display: none;
      justify-content: center;
      gap: 10px;
      margin: 20px;
    }
    .login-popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .login-box {
      background: #222;
      padding: 20px;
      border-radius: 10px;
    }
    .login-box input {
      display: block;
      margin: 10px auto;
      padding: 8px;
      width: 80%;
    }
  </style>
</head>
<body>
  <h1>El Inacapino Puerto Montt</h1>
  <button class="vip-button" onclick="document.getElementById('loginPopup').style.display='flex'">üéõÔ∏è Acceso VIP</button>

  <div class="login-popup" id="loginPopup">
    <div class="login-box">
      <h3>üîê Acceso VIP</h3>
      <input id="vipUser" placeholder="Usuario">
      <input id="vipPass" placeholder="Contrase√±a" type="password">
      <button onclick="verificarAcceso()">Ingresar</button>
    </div>
  </div>

  <div class="admin-controls">
    <button onclick="activarTwitch()">üî¥ Twitch</button>
    <button onclick="activarAutoDJ()">üéß AutoDJ Firebase</button>
  </div>

  <div class="video-overlay-container">
    <img src="Overlay INACAP premium.jpg" alt="Marco de video" class="marco-overlay">
    <iframe id="twitchPlayer" class="video-in-marco" allowfullscreen></iframe>
    <video id="player" class="video-in-marco" controls autoplay muted></video>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDI-jXMqW5HBMk0OT_dfGtxm7AwGo8gRK0",
      authDomain: "inacapino-radio.firebaseapp.com",
      databaseURL: "https://inacapino-radio-default-rtdb.firebaseio.com",
      projectId: "inacapino-radio",
      storageBucket: "inacapino-radio.appspot.com",
      messagingSenderId: "649918235189",
      appId: "1:649918235189:web:5cbd6fd32921a90ecde77c",
      measurementId: "G-25C6GSX57L"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const signalRef = ref(db, 'currentSignal');

    const twitch = document.getElementById('twitchPlayer');
    const player = document.getElementById('player');

    const videos = [
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2F1%20HOUR%20MIX%20(2020).mp4?alt=media&token=6a4b4e70-94c1-46f8-b7dc-6c208e855962",
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2F3%20HORAS%20DE%20MUSICA%20PARA%20LIVE%202022.mp4?alt=media&token=ff7fccf3-fc80-4188-a47b-b7fcb5466425",
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2FGaming%20Music%202023.mp4?alt=media&token=d3330f02-f47d-4557-9e32-8686bd308e43",
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2FJAZZ%20%26%20BLUES%20(conversar%20%2Ccaf%C3%A9%20%2Cestudiar).mp4?alt=media&token=dee26a91-1bc0-4690-aefa-7137d682acdb",
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2FMixElectronic.mp4?alt=media&token=15851287-f7b2-4721-b5cf-e1e1d5d6c994",
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2FM%C3%BAsica%20Electr%C3%B3nica%20para%20Estudiar%2C%20m%C3%BAsica%20para%20levantar%20el%20animo.mp4?alt=media&token=de6e525f-ced4-4e2a-a34f-37f8c1d2546f",
      "https://firebasestorage.googleapis.com/v0/b/inacapino-radio-spark.firebasestorage.app/o/videos%2FSTREAMING%20GAMER.mp4?alt=media&token=ddcc30aa-9b1c-4ab5-b5e8-eac8e417174c"
    ];

    let currentIndex = 0;

    function reproducirVideo(index) {
      player.src = videos[index];
      player.load();
      player.play();
    }

    player.addEventListener("ended", () => {
      currentIndex = (currentIndex + 1) % videos.length;
      reproducirVideo(currentIndex);
    });

    onValue(signalRef, (snapshot) => {
      const estado = snapshot.val();
      const esTwitch = estado === 'twitch';
      twitch.style.display = esTwitch ? 'block' : 'none';
      player.style.display = !esTwitch ? 'block' : 'none';
      if (!esTwitch) {
        currentIndex = 0;
        reproducirVideo(currentIndex);
      }
    });

    window.activarTwitch = () => set(signalRef, 'twitch');
    window.activarAutoDJ = () => set(signalRef, 'firebase');

    window.verificarAcceso = () => {
      const user = document.getElementById('vipUser').value;
      const pass = document.getElementById('vipPass').value;
      if (user === 'Inacapino' && pass === 'SedePuertoMontt') {
        document.getElementById('loginPopup').style.display = 'none';
        document.querySelector('.admin-controls').style.display = 'flex';
      } else {
        alert('Usuario o contrase√±a incorrectos');
      }
    }
  </script>
</body>
</html>
